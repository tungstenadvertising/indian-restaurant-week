---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import HeroSection from '../components/HeroSection.astro';
import WaveDivider from '../components/WaveDivider.astro';
import ContactForm from '../components/ContactForm.astro';
import restaurantsJson from '../../public/data/restaurants.json';

const restaurants = restaurantsJson.restaurants;

// API config for press kit downloads
const apiUrl = import.meta.env.PUBLIC_API_URL || '';
const s3Bucket = import.meta.env.PUBLIC_S3_BUCKET || 'irw-media-uploads';
---

<Layout title="Press Room - Indian Restaurant Week">
    <Navigation restaurants={restaurants} />

    <!-- Hero Section -->
    <HeroSection minHeight="min-h-[60vh]" class="pb-24" patternColor="hsla(29, 27%, 59%, 0.2)" bgColor="linear-gradient(to right, hsla(245, 40%, 51%, 1), hsla(245, 60%, 44%, 1), hsla(245, 40%, 51%, 1))">
        <div class="relative z-20 max-w-4xl mx-auto">
            <h1 class="irw-title text-white font-bold mb-4">Press Room</h1>
            <p class="text-xl md:text-2xl text-white/90 max-w-2xl mx-auto text-pretty">
                Media inquiries, press kits, and resources for covering Indian Restaurant Week
            </p>
        </div>
    </HeroSection>

    <!-- Press Kit Section -->
    <section id="press-kit" class="relative z-10 bg-irw-sand">
        <div class="max-w-7xl mx-auto px-6 md:px-8 lg:px-16 py-16 lg:py-24">
            <!-- Section Title -->
            <div class="text-center mb-12">
                <div class="flex items-center justify-center gap-6 mb-4">
                    <div class="flex-1 max-w-[200px] overflow-hidden relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="320" height="19" fill="currentColor" viewBox="0 0 320 19" class="text-irw-red w-full">
                            <path fill="currentColor" d="m.214 9.39 8.66 8.66 8.66-8.66L8.875.73.215 9.39Zm8.66 0v1.5h320.001v-3h-320v1.5Z"/>
                        </svg>
                    </div>
                    <h2 class="irw-title text-irw-red font-bold whitespace-nowrap">Press Kit</h2>
                    <div class="flex-1 max-w-[200px] overflow-hidden relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="320" height="19" fill="currentColor" viewBox="0 0 320 19" class="text-irw-red w-full" style="transform: scaleX(-1)">
                            <path fill="currentColor" d="m.214 9.39 8.66 8.66 8.66-8.66L8.875.73.215 9.39Zm8.66 0v1.5h320.001v-3h-320v1.5Z"/>
                        </svg>
                    </div>
                </div>
                <p class="text-lg md:text-xl text-gray-700 max-w-2xl mx-auto">
                    Download official assets and materials for media coverage
                </p>
            </div>

            <!-- Press Kit Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                <!-- Logo Package -->
                <div class="bg-white rounded-2xl p-8 shadow-lg text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-16 h-16 bg-irw-amber/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-irw-amber" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Logo Package</h3>
                    <p class="text-gray-600 mb-4 text-sm">Official logos in various formats (PNG, SVG, EPS)</p>
                    <p class="text-xs text-gray-400 mb-3" id="logos-meta"></p>
                    <a href="#" id="logos-download" class="inline-flex items-center text-irw-red font-bold hover:text-irw-orange transition-colors download-link" data-category="logos" style="display: none;">
                        Download
                        <svg class="w-4 h-4 ml-1 download-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                    </a>
                    <span id="logos-unavailable" class="text-gray-400 text-sm">Coming soon</span>
                </div>

                <!-- Photo Gallery -->
                <div class="bg-white rounded-2xl p-8 shadow-lg text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-16 h-16 bg-irw-amber/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-irw-amber" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Photo Gallery</h3>
                    <p class="text-gray-600 mb-4 text-sm">High-resolution images of chefs, dishes, and events</p>
                    <p class="text-xs text-gray-400 mb-3" id="photos-meta"></p>
                    <a href="#" id="photos-download" class="inline-flex items-center text-irw-red font-bold hover:text-irw-orange transition-colors download-link" data-category="photos" style="display: none;">
                        Download
                        <svg class="w-4 h-4 ml-1 download-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                    </a>
                    <span id="photos-unavailable" class="text-gray-400 text-sm">Coming soon</span>
                </div>

                <!-- Press Release -->
                <div class="bg-white rounded-2xl p-8 shadow-lg text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-16 h-16 bg-irw-amber/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-irw-amber" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Press Release</h3>
                    <p class="text-gray-600 mb-4 text-sm">Official announcements and event information</p>
                    <p class="text-xs text-gray-400 mb-3" id="press-releases-meta"></p>
                    <a href="#" id="press-releases-download" class="inline-flex items-center text-irw-red font-bold hover:text-irw-orange transition-colors download-link" data-category="press-releases" style="display: none;">
                        Download
                        <svg class="w-4 h-4 ml-1 download-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                    </a>
                    <span id="press-releases-unavailable" class="text-gray-400 text-sm">Coming soon</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Form Section -->
    <section id="contact" class="relative z-10 bg-irw-amber">
        <!-- <WaveDivider flip class="top-1" /> -->
        <div class="max-w-7xl mx-auto px-6 md:px-8 lg:px-16 py-16 lg:py-24">
            <!-- Section Title -->
            <div class="text-center mb-12">
                <h2 class="irw-title text-white font-bold mb-4">Media Inquiries</h2>
                <p class="text-xl text-white/90 max-w-2xl mx-auto">
                    For press inquiries, interview requests, or additional information, please fill out the form below
                </p>
            </div>

            <!-- Contact Form (self-contained with submission + toast) -->
            <div class="max-w-2xl mx-auto">
                <ContactForm formName="press-inquiry" formId="press-form" source="press-room" />

                <!-- Direct Contact Info -->
                <div class="mt-12 text-center text-white/90">
                    <p class="mb-2">For urgent inquiries, contact us directly:</p>
                    <a href="mailto:mbakshi@tungstenadvertising.com" class="text-white font-bold hover:text-irw-sand transition-colors text-lg">
                        mbakshi@tungstenadvertising.com
                    </a>
                </div>
            </div>
        </div>
        <!-- <WaveDivider class="-top-1" /> -->
    </section>

    <!-- Footer -->
    <section class="relative z-10 bg-irw-sand py-16">
        <div class="text-center">
            <a href="/" class="inline-block">
                <img src="/images/global/irw-logo.svg" alt="Indian Restaurant Week" class="w-24 h-24 mx-auto" loading="lazy">
            </a>
            <p class="text-gray-600 mt-4">© 2025 Indian Restaurant Week. All rights reserved.</p>
        </div>
    </section>
</Layout>

<script define:vars={{ apiUrl, s3Bucket }}>
  /**
   * Load press kit metadata and update download links
   */
  const API_URL = apiUrl;
  const S3_BUCKET = s3Bucket;

  async function loadPressKitMetadata() {
    const categories = ['photos', 'logos', 'press-releases'];

    // Initially hide all download links until we check availability
    categories.forEach(category => {
      const link = document.getElementById(`${category}-download`);
      const unavailable = document.getElementById(`${category}-unavailable`);
      if (link) link.style.display = 'none';
      if (unavailable) unavailable.style.display = 'inline';
    });

    if (!API_URL) {
      // No API - show "coming soon" for all
      return;
    }

    try {
      const response = await fetch(`${API_URL}/admin/press-kit/metadata`);
      if (!response.ok) throw new Error('Failed to fetch metadata');

      const { metadata } = await response.json();

      // Update each category based on availability
      categories.forEach(category => {
        const link = document.getElementById(`${category}-download`);
        const metaEl = document.getElementById(`${category}-meta`);
        const unavailable = document.getElementById(`${category}-unavailable`);
        const categoryData = metadata[category];

        // Check if ZIP is available (has been generated)
        const isAvailable = categoryData && categoryData.lastUpdated && categoryData.zipUrl;

        if (isAvailable) {
          // Show download link, hide "coming soon"
          if (link) {
            link.href = categoryData.zipUrl;
            link.setAttribute('download', '');
            link.style.display = 'inline-flex';
          }
          if (unavailable) {
            unavailable.style.display = 'none';
          }

          // Show metadata
          if (metaEl) {
            const parts = [];
            if (categoryData.fileCount) parts.push(`${categoryData.fileCount} files`);
            if (categoryData.zipSize) parts.push(categoryData.zipSize);
            metaEl.textContent = parts.join(' • ');
          }
        } else {
          // Hide download link, show "coming soon"
          if (link) link.style.display = 'none';
          if (unavailable) unavailable.style.display = 'inline';
          if (metaEl) metaEl.textContent = '';
        }
      });
    } catch (error) {
      console.error('Failed to load press kit metadata:', error);
      // On error, show "coming soon" for all (already set above)
    }
  }

  // Load metadata on page load
  loadPressKitMetadata();
</script>
