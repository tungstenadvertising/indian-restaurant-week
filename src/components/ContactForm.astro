---
// Reusable Contact Form Component
// Used in: Press Room page

interface Props {
    formName?: string;
    formId?: string;
    source?: string; // Track where submission came from
}

const {
    formName = 'press-inquiry',
    formId = 'contact-form',
    source = 'press-room'
} = Astro.props;
---

<form
    name={formName}
    method="POST"
    data-netlify="true"
    class="bg-white shadow-2xl rounded-3xl p-8 md:p-12"
    id={formId}
>
    <input type="hidden" name="form-name" value={formName} />
    <input type="hidden" name="source" value={source} />

    <!-- Name -->
    <div class="mb-6">
        <label for={`${formId}-name`} class="block text-sm font-bold text-gray-700 mb-2">Name *</label>
        <input
            type="text"
            id={`${formId}-name`}
            name="name"
            required
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-irw-amber focus:outline-none transition-colors duration-300 contact-form-input"
            placeholder="Your name"
        />
    </div>

    <!-- Message -->
    <div class="mb-8">
        <label for={`${formId}-message`} class="block text-sm font-bold text-gray-700 mb-2">Message *</label>
        <textarea
            id={`${formId}-message`}
            name="message"
            rows="5"
            required
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-irw-amber focus:outline-none transition-colors duration-300 resize-none contact-form-input"
            placeholder="Tell us about your inquiry..."
        ></textarea>
    </div>

    <!-- Submit Button -->
    <div class="text-center">
        <button
            type="submit"
            class="inline-flex items-center px-10 py-4 bg-irw-red text-white font-bold rounded-full hover:bg-irw-orange transition-all duration-300 ease-smooth transform hover:scale-105 shadow-lg hover:shadow-xl text-lg"
        >
            <span>Send Message</span>
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
        </button>
    </div>
</form>

<style>
    /* Form input focus ring */
    .contact-form-input:focus {
        box-shadow: 0 0 0 3px rgba(231, 136, 36, 0.2);
    }
</style>

<script>
    // Form submission handler
    // Dispatches custom events: 'form:success' and 'form:error' for parent components to handle
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('form[data-netlify="true"]').forEach((form) => {
            const htmlForm = form as HTMLFormElement;
            
            // Skip if already initialized
            if (htmlForm.dataset.initialized) return;
            htmlForm.dataset.initialized = 'true';

            htmlForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(htmlForm);
                const submitButton = htmlForm.querySelector('button[type="submit"]');
                const buttonSpan = submitButton?.querySelector('span');
                const originalText = buttonSpan?.textContent || 'Send Message';

                // Show loading state
                if (submitButton) (submitButton as HTMLButtonElement).disabled = true;
                if (buttonSpan) buttonSpan.textContent = 'Sending...';

                try {
                    const response = await fetch('/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(formData as any).toString()
                    });

                    if (response.ok) {
                        htmlForm.reset();
                        htmlForm.dispatchEvent(new CustomEvent('form:success', { bubbles: true }));
                    } else {
                        throw new Error('Submission failed');
                    }
                } catch (error) {
                    console.error('Form submission error:', error);
                    htmlForm.dispatchEvent(new CustomEvent('form:error', { bubbles: true, detail: error }));
                } finally {
                    if (submitButton) (submitButton as HTMLButtonElement).disabled = false;
                    if (buttonSpan) buttonSpan.textContent = originalText;
                }
            });
        });
    });
</script>
